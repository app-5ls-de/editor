---
layout: bare
---
<h1 id="local"><a href="/local">Local</a></h1>
<hr>
<h1>Shared</h1>
<div style="padding-left: 2rem;">
    <style>
        button {
            /* float: right;
            margin-right: 70%; */
            margin-left: 2rem;
        }

        li {
            height: 2rem;
        }
    </style>
    <ul id="list">
    </ul>
</div>
<hr>
<h1>New</h1>
<a href="/new?auto">create new share</a>
<script>
    var list = document.getElementById("list")

    function rename(id) {
        console.log(id)
        let element = JSON.parse(localStorage[id])
        let title = element.private.title
        if (!title) title = element.private.id
        var newTitle = prompt("Please enter the new title:", element.private.id)
        if (newTitle != null && newTitle != "") {
            element.private.title = newTitle
            localStorage.setItem(id, JSON.stringify(element))
            document.getElementById(id).firstElementChild.innerText = newTitle
        }
    }

    if (localStorage.hasOwnProperty("local") && localStorage.local) {
        let button = document.createElement("button")
        button.innerHTML = "X"
        button.style["font-size"] = "1rem"
        button.onclick = function () {
            localStorage.removeItem(key);
            location.reload();
        }
        button.onclick = function () {
            localStorage.removeItem("local")
            location.reload();
        }
        document.getElementById("local").append(button)
    }

    for (const key in localStorage) {
        if (localStorage.hasOwnProperty(key) && key != "local" && key != "null" && key != "settings") {
            let element
            try {
                element = JSON.parse(localStorage[key])
            } catch (error) {
                //console.log(error)
                localStorage.removeItem(key)
                continue
            }
            console.log(element)
            if (!element || !element.private || !element.private.id) {
                localStorage.removeItem(key)
                continue
            }

            let li = document.createElement("li")
            let a = document.createElement("a")
            let button_delete = document.createElement("button")
            let button_rename = document.createElement("button")

            button_delete.innerHTML = "X"
            button_delete.onclick = function () {
                localStorage.removeItem(key);
                location.reload();
            }

            button_rename.innerHTML = "R"
            button_rename.onclick = function () {
                rename(element.private.id)
            }

            if (element.private.title) {
                a.innerHTML = element.private.title
            } else {
                a.innerHTML = element.private.id
            }

            li.id = element.private.id

            a.href = location.origin + "/shared?id=" + element.private.id
            li.append(a)
            li.append(button_rename)
            li.append(button_delete)
            list.append(li)

        }
    }
</script>