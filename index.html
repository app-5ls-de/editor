---
layout: bare
---
<h1 id="local"><a href="/local">Local</a></h1>
<hr>
<h1>Shared</h1>
<div style="padding-left: 2rem;">
    <style>
        button:first-of-type {
            margin-left: 2rem;
        }

        button {
            padding: 0;
            margin-right: 5px;
        }

        li {
            height: 2rem;
        }

        object {
            width: 1rem;
        }
    </style>
    <ul id="list">
    </ul>
</div>
<hr>
<h1>New</h1>
<a href="/new?auto">create new share</a>
<script>
    var list = document.getElementById("list")

    function rename(id) {
        console.log(id)
        let element = JSON.parse(localStorage[id])
        let title = element.private.title
        if (!title) title = element.private.id
        var newTitle = prompt("Please enter the new title:", element.private.id)
        if (newTitle != null && newTitle != "") {
            element.private.title = newTitle
            localStorage.setItem(id, JSON.stringify(element))
            document.getElementById(id).firstElementChild.innerText = newTitle
        }
    }

    function createElement(element) {
        let li = document.createElement("li")
        let a = document.createElement("a")
        let button_delete = document.createElement("button")
        let button_rename = document.createElement("button")

        button_delete.innerHTML = "<object data='/delete.svg' type='image/svg+xml'></object>"
        button_delete.onclick = function () {
            localStorage.removeItem(element.private.id);
            location.reload();
        }

        button_rename.innerHTML = "<object data='/pencil.svg' type='image/svg+xml'></object>"
        button_rename.onclick = function () {
            rename(element.private.id)
        }

        if (element.private.title) {
            a.innerHTML = element.private.title
        } else {
            a.innerHTML = element.private.id
        }

        li.id = element.private.id

        a.href = location.origin + "/shared?id=" + element.private.id
        li.append(a)
        li.append(button_rename)
        li.append(button_delete)
        return li
    }

    if (localStorage.hasOwnProperty("local") && localStorage.local) {
        let button = document.createElement("button")
        button.innerHTML = "X"
        button.style["font-size"] = "1rem"
        button.onclick = function () {
            localStorage.removeItem("local")
            location.reload();
        }
        document.getElementById("local").append(button)
    }

    for (const key in localStorage) {
        if (localStorage.hasOwnProperty(key) && key != "local" && key != "null" && key != "settings") {
            let element
            try {
                element = JSON.parse(localStorage[key])
            } catch (error) {
                //console.log(error)
                localStorage.removeItem(key)
                continue
            }
            console.log(element)
            if (!element || !element.private || !element.private.id || key != element.private.id) {
                localStorage.removeItem(key)
                continue
            }


            list.append(createElement(element))

        }
    }
</script>